<!DOCTYPE html>

<html>
<head>
  <title>jasq.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jasq.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <pre><code>Jasq v0<span class="hljs-number">.4</span><span class="hljs-number">.1</span> - AMD dependency injector integrated <span class="hljs-keyword">with</span> Jasmine

https:<span class="hljs-comment">//github.com/biril/jasq</span>
Licensed and freely distributed under the MIT License
Copyright (c) <span class="hljs-number">2013</span>-<span class="hljs-number">2014</span> Alex Lambiris
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/*jshint browser:true */</span>
<span class="hljs-comment">/*global define:false, require:false */</span>

define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
<span class="hljs-pi">
  "use strict"</span>;

  <span class="hljs-keyword">var</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    noOp = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{},
    isString = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(s)</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(s) === <span class="hljs-string">"[object String]"</span>;
    },
    isFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(f)</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(f) === <span class="hljs-string">"[object Function]"</span>;
    },
    isStrictlyObject = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(o) === <span class="hljs-string">"[object Object]"</span>;
    },
    each = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj, iterator)</span> </span>{
      <span class="hljs-keyword">var</span> i, l, key;
      <span class="hljs-keyword">if</span> (!obj) { <span class="hljs-keyword">return</span>; }
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.prototype.forEach &amp;&amp; obj.forEach === <span class="hljs-built_in">Array</span>.prototype.forEach) {
        obj.forEach(iterator);
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">if</span> (obj.length === +obj.length) {
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, l = obj.length; i &lt; l; i++) { iterator(obj[i], i, obj); }
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> obj) {
        <span class="hljs-keyword">if</span> (obj.hasOwnProperty(key)) { iterator(obj[key], key, obj); }
      }
    },
    extend = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> target = {};
      each(<span class="hljs-built_in">arguments</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(source)</span> </span>{
        each(source, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(v, k)</span> </span>{ target[k] = v; });
      });
      <span class="hljs-keyword">return</span> target;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    jasmineApiNames = [<span class="hljs-string">"describe"</span>, <span class="hljs-string">"xdescribe"</span>, <span class="hljs-string">"it"</span>, <span class="hljs-string">"xit"</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Jasmine’s native (non-jasq-patched) global API</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    jasmineNativeApi = {},</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    jasmineEnv = <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    jasq = {},</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Get a value indicating whether Jasmine is available on the global scope</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isJasmineInGlobalScope = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.jasmine &amp;&amp; isFunction(<span class="hljs-built_in">window</span>.jasmine.getEnv);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Generate a context-id for given <code>suiteDescription</code> / <code>specDescription</code> pair</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    createContextId = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> uid = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(suiteDescription, specDescription)</span> </span>{
        <span class="hljs-keyword">return</span> suiteDescription + <span class="hljs-string">" "</span> + specDescription + <span class="hljs-string">" "</span> + (uid++);
      };
    }()),</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Re-configure require for context of given id, getting a loader-function. All requirejs
<a href="http://requirejs.org/docs/api.html#config">configuration options</a>, except for the
context itself, are copied over from the default context <code>_</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    configRequireForContext = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(contextId)</span> </span>{
      <span class="hljs-keyword">var</span> c = {};
      each(<span class="hljs-built_in">require</span>.s.contexts._.config, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val, key)</span> </span>{
        <span class="hljs-keyword">if</span> (key !== <span class="hljs-string">"deps"</span>) { c[key] = val; }
      });
      c.context = contextId;
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>.config(c);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3 id="suiteconfigs">suiteConfigs</h3>
<p>A stack of suite configs, the topmost being the ‘current’. For each jasq-<code>describe</code> call
 (i.e. those that define a module and only those) a config is pushed to the stack which
 includes the (name of the) module under test and optionally a mocking function. The module
 will be made available to all specs defined within <em>that</em> (or any <em>nested</em>) suite. The
 mocking function, if present in the configuration, will be invoked on every spec to
 instantiate mocks. (Mocks defined on the spec itself (in the specConfig provided during the
 invocation of <code>it</code>) will override those defined in the suiteConfig)</p>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    suiteConfigs = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> sc = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Get the current suite-config. Or a falsy value if no such thing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      sc.getCurrent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> sc[sc.length - <span class="hljs-number">1</span>];
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Get the path of the current suite-config. Or an empty array if no such thing
 A suite’s path is defined as an array of suite descriptions where</p>
<ul>
<li><code>path[0]</code>: descr. of the top-level suite == (n-1)th parent of current suite</li>
<li><code>path[1]</code>: descr. of (n-2)th parent of current suite</li>
<li><code>path[path.length - 1]</code>: descr. of current suite</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>      sc.getCurrentPath = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> p = [];
        each(sc, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          p.push(sc.description);
        });
        <span class="hljs-keyword">return</span> p;
      };
      <span class="hljs-keyword">return</span> sc;
    }()),</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h3 id="createjasqspec">createJasqSpec</h3>
<p>Create a function to execute the spec of given <code>specDescription</code> and <code>specConfig</code> after
 (re)loading the tested module and mocking its dependencies as specified at the (current)
 suite and (given) spec level</p>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    createJasqSpec = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(specDescription, specConfig)</span> </span>{

      <span class="hljs-keyword">var</span> contextId, load, suiteConfig, mock;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Mods will load in a new requirejs context, specific to this spec. This is its id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      contextId = createContextId(suiteConfigs.getCurrentPath(), specDescription);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Create the context, configuring require appropriately and obtaining a loader</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      load = configRequireForContext(contextId);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Configuration of current suite (name of module to load &amp; mock function)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      suiteConfig = suiteConfigs.getCurrent();</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Modules to mock, as specified at the suite level as well as the spec level</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      mock = extend(suiteConfig.mock ? suiteConfig.mock() : {}, specConfig.mock);

      <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(done)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Re-define modules using given mocks (if any), before they’re loaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        each(mock, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(mod, modName)</span> </span>{ define(modName, mod); });</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>And require the tested module</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        load(suiteConfig.moduleName ? [suiteConfig.moduleName] : [], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(module)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>After module &amp; deps are loaded, just run the original spec’s expectations.
 Dependencies (mocked and non-mocked) should be available through the
 <code>dependencies</code> hash. (Note that a (shallow) copy of dependencies is passed, to
 avoid exposing the original hash that require maintains)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          specConfig.expect(<span class="hljs-built_in">module</span>, extend(<span class="hljs-built_in">require</span>.s.contexts[contextId].defined), done);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>In the event that the expectation-function is <em>not</em> meant to complete
 asynchronously (&lt;=&gt; the expectation-function did <em>not</em> ‘request’ a <code>done</code>
 argument) then it’s already completed. Invoke <code>done</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (specConfig.expect.length &lt; <span class="hljs-number">3</span>) {
            done();
          }
        });
      };
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h3 id="describe">describe</h3>
<p>Get the jasq version of Jasmine’s <code>(x)describe</code></p>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    getJasqDescribe = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(isX)</span> </span>{

      <span class="hljs-keyword">var</span> jasmineDescribe = jasmineNativeApi[isX ? <span class="hljs-string">"xdescribe"</span> : <span class="hljs-string">"describe"</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><code>(x)describe</code>, Jasq version</p>
<ul>
<li><code>suiteDescription</code>: Description of this suite, as in Jasmine’s native <code>describe</code></li>
<li><code>moduleName</code>: Name of the module to which this test suite refers</li>
<li><code>specify</code>: The function to execute the suite’s specs, as in Jasmine’s <code>describe</code></li>
</ul>
<p>OR</p>
<ul>
<li><code>suiteDescription</code>: Description of this suite, as in Jasmine’s native <code>describe</code></li>
<li><code>suiteConfig</code>: Configuration of the suite. A hash containing<ul>
<li><code>moduleName</code>: Name of the module to which this test suite refers</li>
<li><code>mock</code>: Optionally a function that returns a hash of mocks</li>
<li><code>specify</code>: The function to execute the suite’s specs</li>
</ul>
</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(suiteDescription)</span> </span>{

        <span class="hljs-keyword">var</span> args, suite;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Parse given arguments as if they were suitable for the jasq-version of <code>describe</code>.
 <code>args</code> will contain the expected <code>moduleName</code>, <code>mock</code> and <code>specify</code> properties if they
 are, or will be falsy if they’re not. In the latter case, just delegate to the native
 jasmine version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        args = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(args)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Either <code>suiteDescription</code>, <code>moduleName</code>, <code>specify</code> ..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (isString(args[<span class="hljs-number">0</span>]) &amp;&amp; isString(args[<span class="hljs-number">1</span>]) &amp;&amp; isFunction(args[<span class="hljs-number">2</span>])) {
            <span class="hljs-keyword">return</span> { moduleName: args[<span class="hljs-number">1</span>], specify: args[<span class="hljs-number">2</span>] };
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>.. or <code>suiteDescription</code>, <code>suiteConfig</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (isString(args[<span class="hljs-number">0</span>]) &amp;&amp; isStrictlyObject(args[<span class="hljs-number">1</span>])) {
            <span class="hljs-keyword">return</span> args[<span class="hljs-number">1</span>];
          }
        }(<span class="hljs-built_in">arguments</span>));

        <span class="hljs-keyword">if</span> (!args) { <span class="hljs-keyword">return</span> jasmineDescribe.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>); }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Push the current suite-config onto the stack of suite-configs, making it the current
 suite-config. All specs (and nested suites) will make use of this configuration. (if
 this is an <code>xdescribe</code> call, it makes no difference as the suite’s specs will never
 execute anyway. However, it’s simpler to always <code>push</code> here and always <code>pop</code> later,
 avoiding an extra layer of logic)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        suiteConfigs.push({
          description: suiteDescription,
          moduleName: args.moduleName,
          mock: args.mock
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Ultimately, the native Jasmine version is run. The crucial step was setting a
 suite-config for further use in specs and nested suites</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        suite = jasmineDescribe(suiteDescription, args.specify);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Pop the current suite-config</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        suiteConfigs.pop();

        <span class="hljs-keyword">return</span> suite;
      };
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h3 id="it">it</h3>
<p>Get the jasq version of Jasmine’s <code>(x)it</code></p>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    getJasqIt = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(isX)</span> </span>{

      <span class="hljs-keyword">var</span> jasmineIt = jasmineNativeApi[isX ? <span class="hljs-string">"xit"</span> : <span class="hljs-string">"it"</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><code>(x)it</code>, Jasq version</p>
<ul>
<li><code>specDescription</code>: Description of this spec, as in Jasmine’s native <code>it</code></li>
<li><code>specConfig</code>: Configuration of the spec. A hash containing:<ul>
<li><code>store</code>: An array of neames of the modules to ‘store’: These will be
  exposed in the spec through <code>dependencies.store</code> - a hash of modules</li>
<li><code>mock</code>: A hash of mocks, mapping module (name) to mock. These will be
  exposed in the spec through <code>dependencies.mocks</code> - a hash of modules</li>
<li><code>expect</code>: The expectation function: A callback to be invoked with
  <code>module</code> and <code>dependencies</code> arguments</li>
</ul>
</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(specDescription, specConfig)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>In the event that there’s no current suite-config (no module to pass to the spec) then
 just run the native Jasmine version - this will avoid forcing spec to run
 asynchronously. Also run the native version in the case the the caller invoked <code>xit</code> -
 the spec will not execute so there’s no reason to incur the module (re)loading overhead</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!suiteConfigs.getCurrent() || isX) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>We tolerate the caller passing an expectation-hash into a spec which is not nested
 within a jasq-suite - in this case we’re only interested in the expectation-function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (isStrictlyObject(specConfig)) {
            specConfig = specConfig.expect;
          }

          <span class="hljs-keyword">return</span> jasmineIt.call(<span class="hljs-literal">null</span>, specDescription, specConfig);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Create a specConfig, in case the caller passed an expectation-function instead</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!isStrictlyObject(specConfig)) {
            specConfig = { expect: specConfig };
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Execute Jasmine’s <code>(x)it</code> on an appropriately modified <em>asynchronous</em> spec</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> jasmineIt(specDescription, createJasqSpec(specDescription, specConfig));
      };
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h3 id="init">init</h3>
<p>Ensure that <code>jasmineEnv</code> and <code>jasmineNativeApi</code> have been set and create the
 patched version of Jasmine’s API. Will only run once</p>

            </div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    init = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">if</span> (!isJasmineInGlobalScope()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"Jasmine is not available in global scope (not loaded?)"</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Store Jasmine’s globals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      jasmineEnv = <span class="hljs-built_in">window</span>.jasmine.getEnv();
      each(jasmineApiNames, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{ jasmineNativeApi[name] = <span class="hljs-built_in">window</span>[name]; });</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Create patched version of Jasmine’s API</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      jasq.describe  = getJasqDescribe();
      jasq.xdescribe = getJasqDescribe(<span class="hljs-literal">true</span>);
      jasq.it        = getJasqIt();
      jasq.xit       = getJasqIt(<span class="hljs-literal">true</span>);

      each(jasmineApiNames, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{ jasq[name].isJasq = <span class="hljs-literal">true</span>; });</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Don’t <code>init</code> more than once</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      init = noOp;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  jasq.applyGlobals = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    init();
    each(jasmineApiNames, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{ <span class="hljs-built_in">window</span>[name] = jasq[name]; });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  jasq.resetGlobals = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    init();
    each(jasmineApiNames, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{ <span class="hljs-built_in">window</span>[name] = jasmineNativeApi[name]; });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>If Jasmine is already in global scope then go ahead and apply globals - this will also
 initialize jasq</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (isJasmineInGlobalScope()) { jasq.applyGlobals(); }

  <span class="hljs-keyword">return</span> jasq;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
